<html>
  <head>
    <meta charset="utf-8">
    <style>
      *{
        font-family: 'Courier New', Courier, monospace;
        margin: 0;
        padding: 0;
      }
      body {
        background-color: rgb(27, 27, 34);
      }
      .wrapper {
        display: inline-block;
        position: absolute;
        left : 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
      }
      h1, h2 {
        margin-bottom: 20px;
        color: white;
      }
    </style>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.4.0/gl-matrix-min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="lTriangle.js"></script>
    <script type="text/javascript" src="square.js"></script>
    <script type="text/javascript" src="circle.js"></script>
    <script type="text/javascript" src="hRectangle.js"></script>
    <script type="text/javascript" src="vRectangle.js"></script>
    <script type="text/javascript" src="longHRectangle.js"></script>
    <script type="text/javascript" src="topRounded.js"></script>
    <script type="text/javascript" src="topTrapezium.js"></script>
    <script type="text/javascript" src="haste.js"></script>
    <script type="text/javascript">
      let mMatrix = mat4.create();
      let vMatrix = mat4.create();
      let pMatrix = mat4.create();

      let mMatrixPilha = [];
      
      $(function() {
	      iniciaWebGL();
      });

      function degToRad(graus) {
        return graus * Math.PI / 180;
      }

      function mPushMatrix() {
        var copy = mat4.clone(mMatrix);
        mMatrixPilha.push(copy);
      }

      function mPopMatrix() {
        if (mMatrixPilha.length == 0) {
          throw "inválido popMatrix!";
        }
        mMatrix = mMatrixPilha.pop();
      }

      function iniciaWebGL() {
        var canvas = $('#canvas-webgl')[0];
        iniciarGL(canvas); 
        iniciarShaders();
        iniciarAmbiente(); 
        tick();    
      }


      var ultimo = 0;
      function animar() {
        var agora = new Date().getTime();
        if (ultimo != 0) {
          var diferenca = agora - ultimo;
          rTri += ((90 * diferenca) / 1000.0) % 360.0;
          rQuad += ((75 * diferenca) / 1000.0) % 360.0;
        }
        ultimo = agora;
      }

      function tick() {
        requestAnimationFrame(tick);
        desenharCena();
        animar();
      }

      function iniciarGL(canvas) {
        try {
          gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
          gl.viewportWidth = canvas.width;
          gl.viewportHeight = canvas.height;
        } catch(e) {
          if(!gl) alert("Não pode inicializar WebGL, desculpe");
        }
      }

      var shaderProgram;

      function iniciarShaders() {
        var vertexShader = getShader(gl, "#shader-vs");
        var fragmentShader = getShader(gl, "#shader-fs");
        
        shaderProgram = gl.createProgram();

        gl.attachShader(shaderProgram, vertexShader);
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);
      
        if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS))
        	alert("Não pode inicializar shaders");
      
        gl.useProgram(shaderProgram);
      
        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

        shaderProgram.vertexColorAttribute = gl.getAttribLocation(shaderProgram, "aVertexColor");
        gl.enableVertexAttribArray(shaderProgram.vertexColorAttribute);
        
        shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
        shaderProgram.vMatrixUniform = gl.getUniformLocation(shaderProgram, "uVMatrix");
        shaderProgram.mMatrixUniform = gl.getUniformLocation(shaderProgram, "uMMatrix");
      }
    
      function getShader(gl, id) {
        var shaderScript = $(id)[0];
        if(!shaderScript) 
          return null;

        var str = "";
        var k = shaderScript.firstChild;
        while(k) {
          if(k.nodeType == 3)
            str += k.textContent;
          k = k.nextSibling;
        }
        
        var shader;
        if(shaderScript.type == "x-shader/x-fragment")
          shader = gl.createShader(gl.FRAGMENT_SHADER);
        else if(shaderScript.type == "x-shader/x-vertex")
          shader = gl.createShader(gl.VERTEX_SHADER);
        else
          return null;
        
        gl.shaderSource(shader, str);
        gl.compileShader(shader);
        
        if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          alert(gl.getShaderInfoLog(shader));
          return null;
        }
        
        return shader;
      }


      function iniciarAmbiente() {
        gl.clearColor(0.2, 0.6, 0.8, 1.0);
        // gl.clearColor(0.2, 0.3, 0.4, 1.0);
        gl.enable(gl.DEPTH_TEST);
      }

      function desenharCena() {
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        mat4.perspective(pMatrix, 45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0);
        mat4.identity(mMatrix);
        mat4.identity(vMatrix);
        
        let translation = vec3.create();

		    //---------------|-------cor--------|  |----translação----||scale||alpha||radius||offset|| translation|
        hRectangle     ( [ 0.00, 0.71, 1.00 ], [ -1.00,  0.00, -9 ], 1.00, 1.0,                   translation )
        vRectangle     ( [ 0.38, 0.00, 1.00 ], [  3.00,  1.00,  0 ], 1.00, 1.0,                   translation )
        longHRectangle ( [ 1.00, 0.00, 0.00 ], [ -2.00, -2.40,  0 ], 1.00, 1.0,                   translation )
        longHRectangle ( [ 0.38, 0.00, 1.00 ], [  1.75,  4.20,  1 ], 0.40, 1.0,                   translation )
        square         ( [ 1.00, 1.00, 1.00 ], [ -0.20, -1.50,  1 ], 0.50, 1.0,                   translation )
        circle         ( [ 0.00, 1.00, 0.30 ], [  0.10, -2.70,  0 ], 0.50, 1.0,                   translation )
        circle         ( [ 1.00, 0.00, 1.00 ], [ -1.20,  0.00,  0 ], 0.50, 1.0,                   translation )
        circle         ( [ 0.00, 0.30, 0.00 ], [ -1.20, -0.10,  0 ], 0.40, 1.0,                   translation )
        circle         ( [ 1.00, 0.40, 0.00 ], [ -1.00,  0.00,  0 ], 0.40, 1.0,                   translation )
        lTriangle      ( [ 0.10, 0.38, 0.06 ], [ -0.55,  0.15,  0 ], 0.60, 1.0,                   translation )
        topRounded     ( [ 0.90, 0.65, 0.20 ], [  1.80,  2.22,  1 ], 0.20, 1.0,                   translation )
        vRectangle     ( [ 1.00, 0.90, 0.00 ], [ -0.80, -0.02,  1 ], 0.15, 1.0,                   translation )
        topTrapezium   ( [ 0.20, 0.10, 0.70 ], [  0.26,  0.19,  1 ], 0.12, 1.0,                   translation )
        haste          ( [ 0.20, 0.10, 0.70 ], [  1.50, -1.65,  1 ], 0.07, 1.0,  0.155,    0.0,   translation )
        haste          ( [ 0.50, 0.10, 0.70 ], [  0.51, -1.68,  1 ], 0.06, 1.0,  0.125,  100.0,   translation )
      }

      function setMatrixUniforms() {
        gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
        gl.uniformMatrix4fv(shaderProgram.vMatrixUniform, false, vMatrix);
        gl.uniformMatrix4fv(shaderProgram.mMatrixUniform, false, mMatrix);
      }

    </script>
    <script id="shader-vs" type="x-shader/x-vertex">
      attribute vec3 aVertexPosition;
      attribute vec4 aVertexColor;
      
      uniform mat4 uMMatrix;
      uniform mat4 uVMatrix;
      uniform mat4 uPMatrix;
      
      varying vec4 vColor;
      
      void main(void) {
        gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
        vColor = aVertexColor;
      }
    </script>
    <script id="shader-fs" type="x-shader/x-fragment">
      precision mediump float;
      varying vec4 vColor;
      
      void main(void) {
        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
        gl_FragColor = vColor;
      }
    </script>
  </head>
  <body>
    <div class='wrapper'>
      <h1>Trabalho 1 CG</h1>
      <h2>Leonam Teixeira de Vasconcelos</h2>
      <canvas id="canvas-webgl" width="500px" height="500px" style="border:none">
      </canvas>
  </div>
  </body>
</html> 
